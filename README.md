**요약**
- 영속성 유닛
  - EntityManagerFactory 인스턴스를 생성하는 데 필요한 모든 정보가 담긴 상자
  - 데이터 소스, 관리되는 엔터티 목록, 기타 속성에 대한 세부 정보 등이 있음
- EntityManagerFactory
  - 온디맨드 EntityManager 인스턴스를 생성하는 팩토리
  - 영속성 유닛으로 제공된 정보를 통해 호출될 때마다 애플리케이션에서 관리되는 새로운 EntityManager 인스턴스를 반환하는 `createEntityManager()` 메서드 제공
  - 프로그래밍 방식으로 주입(`@PersistenceUnit`)되거나, `Persistence#createEntityManagerFactory()`를 통해 EntityManagerFactory를 만들 수 있음
  - `isOpend()` 메서드로 EntityManagerFactory 상태 확인 가능
  - `close()` 메서드로 닫을 수 있으며, 닫으면 모든 엔터티 관리자는 닫힌 상태로 간주
- EntityManager
  - DB에서 데이터를 가져오면 메모리에 해당 데이터의 복사본이 생성됨 -> 해당 메모리 영역을 영속성 콘텍스트(=1차 캐시)라고 함
  - 애플리케이션에서는 엔터티를 통해 해당 결과 세트를 액세스/관리함
  - 해당 콘텍스트 활용을 용이하게 하고자 하이버네이트 JPA는 가져온 결과 세트를 raw 데이터 배열과, 관리된 엔터티로 일컫는 관리 가능한 표현 방식으로 변환하는 고유 기술 적용
  - 하나의 단일 활성 영속성 콘텍스트가 현재 활성화된 DB 트랜잭션에 할당돼야 함
  - 통상적으로 EntityManager 인스턴스 = 현재의 영속성 콘텍스트
  - DB 물리적 트랜잭션당 둘 이상의 영속성 콘텍스트를 사용하지 말아야 함
  - 플러시 : 메모리 내의 영속성 콘텍스트를 수정하면 DB에 수정 사항을 반영
    - AUTO 전략 : 모든 쿼리 실행 전과 트랜잭션 커밋 이전에 자동으로 트리거 됨
    - COMMIT 전략 : 트랜잭션 커밋 이전에만 발생
  - 현재 트랜잭션이 완료되면 영속성 콘텍스트에 있던 모든 객체가 분리됨
    - 특정 엔터티는 `detach()` 메서드로 분리될 수 있음
    - 후속 변경 사항을 전파하는 것은 활성화된 트랜잭션 콘텍스트에서 객체를 병합하거나 재결합 후에만 가능
- 엔터티 상태 전이
  - Transient(또는 New) : DB에게 완전히 알려지지 않은 새로운 엔터티
  - Managed(또는 Persistent) : DB에 해당 행이 존재하며, 현재 영속성 콘텍스트에 로드되어 있음
  - Detached : 영속성 콘텍스트에 있었지만 영속성 콘텍스트가 닫혔거나 엔터티가 지워졌거나 제거된 경우
  - Removed: 엔터티는 영속성 콘텍스트에 있었고 삭제되게 표시함

**심화**
- JPA 병합 : DB에서 새 엔터티 객체를 로드하고 분리된 엔터티 내부 상태를 복사해 업데이트
  - 영속성 콘텍스트에 이미 필요한 엔터티가 관리되고 있으면 세션 수준 반복 읽기를 활용
- 하이버네이트 재결합 : 전달된 엔터티 객체를 분리된 상태에서 병합된 상태로 전환
  - transient 엔터티나 현재 영속성 콘텍스트에 로드된 엔터티를 재결합하려고 하면 예외 발생
- 결론
  - 분리된 엔터티 상태를 복사하려고 함 -> JPA `merge()` 사용
  - 배치 처리를 하려고 함 -> 하이버네이트 `update()` 사용
  - 엔터티를 저장하려고 함 -> JPA `persist()` 사용
